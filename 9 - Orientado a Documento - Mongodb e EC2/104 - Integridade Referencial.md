104. Integridade Referencial
Ao longo do nosso estudo, nós falamos que a família de bancos NoSQL, os produtos NoSQL. Eles vieram para atender questões de dados, necessidades relacionadas a aplicações orientadas a dados com requisitos diferentes dos sistemas relacionais. Então, existiam necessidades diferenciadas que não eram atendidas ou eram atendidas parcialmente pelos sistemas relacionais. E uma das características dos bancos de dados NoSQL é a não existência da integridade referencial, ou seja, sem integridade referencial, com integridade referencial mais flexível. Isso dá maior uma característica, maior disponibilidade e desempenho para os bancos de dados NoSQL.

Então, como são vários tipos, várias formas de se implementar NoSQL, não quer dizer que ela não exista completamente. Ela pode existir, mas de uma forma diferenciada e mais flexível do que com relação se comparado aos bancos de dados relacionais, onde a integridade referencial é uma característica forte, uma característica dominante.

Como funciona a questão da integridade referencial no MongoDB?
Então, em princípio, não existe integridade referencial.
Você pode criar links entre as entre documentos.
Porém, se você excluir um documento filho, esse link vai ficar órfão. Ele vai apontar para lugar nenhum, então pode se incluir um link para outro documento. Mas isso não quer dizer que o Mongo vai manter qualquer tipo de integridade. Se você quiser manter integridade, você vai ter que fazer isso pela aplicação. Se, por exemplo, você não quiser permitir que um registro filho seja excluído, existindo um pai, você vai ter que tratar isso na aplicação.
Se acontecer do documento filho ser excluído, o link vai ficar órfão Ele vai apontar para lugar nenhum.
Se você precisar se a sua aplicação é um requisito da sua aplicação, integridade, referenciar ou você desenvolve isso no aplicação do software.
Ou você vai procurar um gerenciador de banco de dados relacional que ofereça suporte a documentos com integridade referencial e existe em alguns produtos. Existem vários produtos no mercado que têm essas características, mas eles podem não ter algumas das características importantes que um banco de dados você criou, como Mongo DB oferece. Então, é preciso avaliar não apenas este quesito.

Como funcionam os documentos embarcados, os documentos embutidos. Então vamos ver aqui um exemplo: aqui a gente tem dados de um cliente, então, a gente tem um documento. Com o nome do cliente, por exemplo, a gente pode ter outros atributos do Cliente. E o que a gente vai ter. A gente vai ter em uma outra coleção, uma coleção separada, o endereço dele.
Então, vejam aqui: Aqui eu tenho o ID 1010 e eu vou ter uma outra coleção com o endereço. Mas não existe aqui uma relação entre os dois. Você vai ter que fazer isso pela aplicação. Não existe qualquer link entre os dois.
Uma outra forma de você implementar isso no MongoDB é através dos documentos indutivos embarcados. Então, vejam aqui como isso fica diferente. Você tem na mesma coleção o endereço, é como se você tivesse aqui um documento dentro de outro. Então aqui você tem o identificador. E aqui você tem o endereço. 

Isso funciona bem no mongo, só o que acontece? Qual é a desvantagem desse sistema? É redundância.
Então, por exemplo, é um banco de dados relacional. Você tem cadastros. Geralmente você vai ter um cadastro com os endereços.
Então, por exemplo, o mesmo endereço vai ser cadastrado em uma tabela de endereços, por exemplo, uma vez só. Aqui, nesse modelo de documentos embutidos no mongo, você vai ter redundância. Então, outra pessoa que morar neste mesmo endereço você vai ter que cadastrar o endereço de novo, de novo e de novo e de novo. Então isso pode aumentar bastante os dados. Outro problema é que, se, por exemplo, que tiver uma alteração nesse endereço, por exemplo, o CEP de uma determinada rua mudar, você vai ter que alterar todos os endereços toda vez que seu endereço aparecer no banco de dados, o que pode ser, do ponto de vista computacional, de programação, um grande esforço. Então, para algumas questões que você não vai precisar atualizar, que não existe, é possível. Se você atualizar, por exemplo, a coleção que está dentro da outra, aí é uma boa alternativa.

E o mongo também oferece referências a documentos.
Então, aqui é como se existisse um link, então, em vez de cadastrar o endereço aqui dentro, embutido dentro, como a gente viu lá no outro, o que ele faz aqui o endereço ele aponta para um outro documento, então, esse outro documento aqui sim.  Neste caso, se o endereço ele tiver uma, por exemplo, uma alteração no CEP, eu vou precisar alterar o CEP apenas uma vez. Então existe aqui uma referência, um link criado pelo mongo, porém, o que acontece isso aqui não representa integridade referencial. Se você tiver milhares de usuários com o endereço apontando aqui do endereço 121314, e você simplesmente excluir esse documento, todas essas referências aqui elas vão ficar órfãs. O mongo não vai fazer qualquer tipo de tratamento, de integridade referencial, ele não vai tentar impedir, ele não vai gerar uma mensagem de erro nem nada. Simplesmente o documento vai ser excluído e todas as referências vão ficar órfãs.

Então, o importante aqui é que a gente tem que observar e que, como tudo relacionado à tecnologia, a escolha do produto deve levar em consideração as vantagens e desvantagens. Então, embora o banco de dados, o jogo não ofereça integridade referencial no sentido de impedir de manter os dados íntegros, ele oferece algumas funcionalidades de referência e documentos embutidos. E o importante, como eu estava falando, é que você faça quando você vai escolher o seu produto. Para armazenar dados, você tem que avaliar as trocas, as vantagens e as desvantagens em muitos casos.
Apesar dessas características diferenciadas do MongoDB, para muitos casos ele se torna o principal produto mais atrativo, que traz mais vantagens. Tanto é que ele e o banco de dados NoSQL mais utilizado no mundo hoje (Atualmente).
